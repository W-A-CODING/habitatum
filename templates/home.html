{% extends 'base.html' %}
{% load humanize %}

{% block title %}Inicio - Habitatum{% endblock %}

{% block extra_css %}
<style>
    /* Hero Section - Estilos base */
    .hero {
        background: linear-gradient(135deg, var(--azul-claro) 0%, var(--azul-oscuro) 100%);
        color: var(--blanco);
        padding: var(--espacio-xl) var(--espacio-lg);
        text-align: center;
        border-radius: var(--radio-lg);
        margin-bottom: var(--espacio-xl);
        position: relative;
        overflow: hidden;
    }
    
    .hero h1 {
        font-size: 3rem;
        margin-bottom: var(--espacio-md);
        font-weight: 700;
    }
    
    .hero p {
        font-size: 1.25rem;
        margin-bottom: var(--espacio-lg);
        color: var(--azul-medio);
    }
    
    .hero-buttons {
        display: flex;
        gap: var(--espacio-md);
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .hero-buttons .btn {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* ========================================
       PROPERTY CARDS - MOTION STYLES
    ======================================== */
    
    .propiedades-destacadas {
        margin-bottom: var(--espacio-xl);
    }
    
    .propiedades-destacadas h2 {
        text-align: center;
        color: var(--azul-oscuro);
        font-size: 2rem;
        margin-bottom: var(--espacio-lg);
    }
    
    .carousel {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--espacio-lg);
        margin-bottom: var(--espacio-lg);
    }
    
    .property-card {
        background-color: var(--blanco);
        border-radius: var(--radio-lg);
        overflow: hidden;
        box-shadow: var(--sombra-md);
        text-decoration: none;
        color: var(--negro);
        display: flex;
        flex-direction: column;
        position: relative;
    }
    
    /* Contenedor de imagen con overflow hidden */
    .property-card > img,
    .property-card > div:first-child {
        width: 100%;
        height: 200px;
        overflow: hidden;
        position: relative;
    }
    
    .property-card-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        background-color: var(--beige);
        display: block;
    }
    
    .property-card-content {
        padding: var(--espacio-md);
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
        background-color: var(--blanco);
    }
    
    .property-card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--azul-oscuro);
        margin-bottom: var(--espacio-sm);
    }
    
    .property-card-location {
        color: var(--gris-medio);
        font-size: 0.875rem;
        margin-bottom: var(--espacio-sm);
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .property-card-details {
        display: flex;
        gap: var(--espacio-md);
        margin-bottom: var(--espacio-md);
        font-size: 0.875rem;
        color: var(--gris-medio);
    }
    
    .property-card-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--naranja);
        margin-top: auto;
    }
    
    .no-propiedades {
        text-align: center;
        padding: var(--espacio-xl);
        background-color: var(--beige);
        border-radius: var(--radio-lg);
    }
    
    .no-propiedades p {
        color: var(--gris-medio);
        font-size: 1.125rem;
    }
    
    /* ========================================
       CARACTER√çSTICAS SECTION - MOTION STYLES
    ======================================== */
    
    .caracteristicas {
        background-color: var(--beige);
        padding: var(--espacio-xl) var(--espacio-lg);
        border-radius: var(--radio-lg);
        margin-bottom: var(--espacio-xl);
    }
    
    .caracteristicas h2 {
        text-align: center;
        color: var(--azul-oscuro);
        font-size: 2rem;
        margin-bottom: var(--espacio-lg);
    }
    
    .caracteristicas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--espacio-lg);
    }
    
    .caracteristica-item {
        text-align: center;
        padding: var(--espacio-lg);
        background-color: var(--blanco);
        border-radius: var(--radio-md);
        box-shadow: var(--sombra-sm);
        position: relative;
    }
    
    .caracteristica-icon {
        font-size: 3rem;
        margin-bottom: var(--espacio-md);
        display: inline-block;
    }
    
    .caracteristica-item h3 {
        color: var(--azul-oscuro);
        margin-bottom: var(--espacio-sm);
        font-size: 1.25rem;
    }
    
    .caracteristica-item p {
        color: var(--gris-medio);
        line-height: 1.6;
    }
    
    /* ========================================
       CTA SECTION - MOTION STYLES
    ======================================== */
    
    .cta-section {
        background-color: var(--azul-claro);
        color: var(--blanco);
        padding: var(--espacio-xl) var(--espacio-lg);
        border-radius: var(--radio-lg);
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    /* Efecto de fondo animado (opcional) */
    .cta-section::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: pulse 8s ease-in-out infinite;
        pointer-events: none;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.5; }
        50% { transform: scale(1.1); opacity: 0.3; }
    }
    
    .cta-section h2 {
        font-size: 2rem;
        margin-bottom: var(--espacio-md);
        position: relative;
        z-index: 1;
    }
    
    .cta-section p {
        font-size: 1.125rem;
        margin-bottom: var(--espacio-lg);
        color: var(--beige);
        position: relative;
        z-index: 1;
    }
    
    .cta-section .btn {
        position: relative;
        z-index: 1;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .hero h1 {
            font-size: 2rem;
        }
        
        .hero p {
            font-size: 1rem;
        }
        
        .carousel {
            grid-template-columns: 1fr;
        }
        
        .caracteristicas-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <section class="hero" id="heroSection">
        <h1 class="hero-title">Encuentra tu hogar ideal</h1>
        <p class="hero-text">Propiedades de calidad con asesor√≠a crediticia personalizada</p>
        <div class="hero-buttons">
            <a href="{% url 'properties:property_list' %}" class="btn btn-primary hero-btn">Ver Propiedades</a>
            <a href="{% url 'core:services' %}" class="btn btn-secondary hero-btn">Nuestros Servicios</a>
        </div>
    </section>
    
    <!-- Propiedades Destacadas -->
    <section class="propiedades-destacadas">
        <h2>Propiedades Destacadas</h2>
        
        {% if propiedades %}
        <div class="carousel">
            {% for propiedad in propiedades %}
            <a href="{% url 'properties:property_detail' propiedad.pk %}" class="property-card">
                {% if propiedad.imagen_principal %}
                <img src="{{ propiedad.imagen_principal.url }}" alt="{{ propiedad.nombre }}" class="property-card-image">
                {% else %}
                <div class="property-card-image" style="display: flex; align-items: center; justify-content: center; color: var(--gris-medio);">
                    üè† Sin imagen
                </div>
                {% endif %}
                
                <div class="property-card-content">
                    <h3 class="property-card-title">{{ propiedad.nombre }}</h3>
                    <p class="property-card-location">üìç {{ propiedad.ubicacion }}</p>
                    
                    <div class="property-card-details">
                        <span>üìê {{ propiedad.metros_cuadrados }} m¬≤</span>
                        <span>üè† {{ propiedad.get_tipo_inmueble_display }}</span>
                    </div>
                    
                    <p class="property-card-price">${{ propiedad.precio|floatformat:0|intcomma }} MXN</p>
                </div>
            </a>
            {% endfor %}
        </div>
        
        <div style="text-align: center;">
            <a href="{% url 'properties:property_list' %}" class="btn btn-secondary">Ver Todas las Propiedades</a>
        </div>
        {% else %}
        <div class="no-propiedades">
            <p>Por el momento no hay propiedades disponibles. ¬°Pronto tendremos nuevas opciones para ti!</p>
        </div>
        {% endif %}
    </section>
    
    <!-- Caracter√≠sticas -->
    <section class="caracteristicas">
        <h2>¬øPor qu√© elegir Habitatum?</h2>
        <div class="caracteristicas-grid">
            <div class="caracteristica-item">
                <div class="caracteristica-icon">üè†</div>
                <h3>Propiedades de Calidad</h3>
                <p>Seleccionamos cuidadosamente cada propiedad para ofrecerte las mejores opciones del mercado.</p>
            </div>
            
            <div class="caracteristica-item">
                <div class="caracteristica-icon">üí∞</div>
                <h3>Asesor√≠a Crediticia</h3>
                <p>Te ayudamos a encontrar el mejor cr√©dito hipotecario seg√∫n tus necesidades e ingresos.</p>
            </div>
            
            <div class="caracteristica-item">
                <div class="caracteristica-icon">ü§ù</div>
                <h3>Acompa√±amiento Total</h3>
                <p>Desde la primera visita hasta la firma de escrituras, estaremos contigo en cada paso.</p>
            </div>
            
            <div class="caracteristica-item">
                <div class="caracteristica-icon">‚ö°</div>
                <h3>Proceso R√°pido</h3>
                <p>Agilizamos todos los tr√°mites para que encuentres tu hogar lo m√°s pronto posible.</p>
            </div>
        </div>
    </section>
    
    <!-- CTA Final -->
    <section class="cta-section">
        <h2>¬øListo para encontrar tu hogar?</h2>
        <p>Agenda una cita y descubre la propiedad perfecta para ti</p>
        <a href="{% url 'properties:property_list' %}" class="btn btn-primary" style="background-color: var(--naranja);">Explorar Propiedades</a>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<!-- Motion Dev CDN -->
<script src="https://cdn.jsdelivr.net/npm/motion@11.11.13/dist/motion.js"></script>

<script>
    // Destructurar Motion
    const { animate, stagger, inView, scroll, spring } = Motion;
    
    document.addEventListener('DOMContentLoaded', function() {
        
        // ========================================
        // HERO SECTION ANIMATION
        // ========================================
        
        // Animar t√≠tulo del hero
        animate(
            ".hero-title",
            { 
                opacity: [0, 1],
                y: [30, 0]
            },
            { 
                duration: 0.8,
                easing: "ease-out"
            }
        );
        
        // Animar texto del hero
        animate(
            ".hero-text",
            { 
                opacity: [0, 1],
                y: [30, 0]
            },
            { 
                duration: 0.8,
                delay: 0.2,
                easing: "ease-out"
            }
        );
        
        // Animar botones del hero con stagger
        animate(
            ".hero-btn",
            { 
                opacity: [0, 1],
                y: [30, 0],
                scale: [0.9, 1]
            },
            { 
                duration: 0.6,
                delay: stagger(0.1, { start: 0.4 }),
                easing: "ease-out"
            }
        );
        
        // Hover effect para botones del hero
        const heroBtns = document.querySelectorAll('.hero-btn');
        heroBtns.forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                animate(
                    this,
                    { 
                        y: -3,
                        scale: 1.05
                    },
                    { 
                        duration: 0.3,
                        easing: [0.4, 0, 0.2, 1]
                    }
                );
            });
            
            btn.addEventListener('mouseleave', function() {
                animate(
                    this,
                    { 
                        y: 0,
                        scale: 1
                    },
                    { 
                        duration: 0.3,
                        easing: [0.4, 0, 0.2, 1]
                    }
                );
            });
        });
        
        // ========================================
        // PROPERTY CARDS ANIMATION
        // ========================================
        
        // Animar t√≠tulo de la secci√≥n cuando sea visible
        inView(
            ".propiedades-destacadas h2",
            ({ target }) => {
                animate(
                    target,
                    { 
                        opacity: [0, 1],
                        y: [20, 0]
                    },
                    { 
                        duration: 0.6,
                        easing: "ease-out"
                    }
                );
                
                return () => {}; // cleanup
            }
        );
        
        // Animar property cards con stagger cuando sean visibles
        inView(
            ".property-card",
            ({ target }) => {
                const allCards = document.querySelectorAll('.property-card');
                
                animate(
                    allCards,
                    { 
                        opacity: [0, 1],
                        y: [40, 0],
                        scale: [0.95, 1]
                    },
                    { 
                        duration: 0.6,
                        delay: stagger(0.1),
                        easing: [0.4, 0, 0.2, 1]
                    }
                );
                
                return () => {}; // cleanup
            },
            { amount: 0.2 } // Se activa cuando 20% es visible
        );
        
        // Hover effects para property cards
        const propertyCards = document.querySelectorAll('.property-card');
        
        propertyCards.forEach(card => {
            const image = card.querySelector('.property-card-image');
            const title = card.querySelector('.property-card-title');
            const price = card.querySelector('.property-card-price');
            
            card.addEventListener('mouseenter', function() {
                // Animar card
                animate(
                    card,
                    { 
                        y: -8,
                        scale: 1.02,
                        boxShadow: "0 12px 24px rgba(0, 0, 0, 0.15)"
                    },
                    { 
                        duration: 0.4,
                        easing: [0.4, 0, 0.2, 1]
                    }
                );
                
                // Zoom en imagen (sin parallax, solo zoom)
                if (image) {
                    animate(
                        image,
                        { scale: 1.1 },
                        { duration: 0.5, easing: [0.4, 0, 0.2, 1] }
                    );
                }
                
                // Color del t√≠tulo
                if (title) {
                    animate(
                        title,
                        { color: "#3A89C9" },
                        { duration: 0.3 }
                    );
                }
                
                // Scale del precio
                if (price) {
                    animate(
                        price,
                        { scale: 1.05 },
                        { duration: 0.3 }
                    );
                }
            });
            
            card.addEventListener('mouseleave', function() {
                // Resetear card
                animate(
                    card,
                    { 
                        y: 0,
                        scale: 1,
                        boxShadow: "0 4px 8px rgba(0, 0, 0, 0.15)"
                    },
                    { 
                        duration: 0.4,
                        easing: [0.4, 0, 0.2, 1]
                    }
                );
                
                // Resetear imagen
                if (image) {
                    animate(
                        image,
                        { scale: 1 },
                        { duration: 0.5, easing: [0.4, 0, 0.2, 1] }
                    );
                }
                
                // Resetear t√≠tulo
                if (title) {
                    animate(
                        title,
                        { color: "#1B325F" },
                        { duration: 0.3 }
                    );
                }
                
                // Resetear precio
                if (price) {
                    animate(
                        price,
                        { scale: 1 },
                        { duration: 0.3 }
                    );
                }
            });
        });
        
        // Animar bot√≥n "Ver Todas"
        const verTodasContainer = document.querySelector('.propiedades-destacadas > div[style*="text-align: center"]');
        if (verTodasContainer) {
            inView(
                verTodasContainer,
                ({ target }) => {
                    animate(
                        target,
                        { 
                            opacity: [0, 1],
                            y: [20, 0]
                        },
                        { 
                            duration: 0.6,
                            easing: "ease-out"
                        }
                    );
                    
                    return () => {};
                }
            );
        }
        
        // Animar mensaje "no propiedades"
        const noPropiedades = document.querySelector('.no-propiedades');
        if (noPropiedades) {
            inView(
                noPropiedades,
                ({ target }) => {
                    animate(
                        target,
                        { 
                            opacity: [0, 1],
                            y: [20, 0],
                            scale: [0.95, 1]
                        },
                        { 
                            duration: 0.8,
                            easing: "ease-out"
                        }
                    );
                    
                    return () => {};
                }
            );
        }
        
        // ========================================
        // CARACTER√çSTICAS SECTION ANIMATION
        // ========================================
        
        // Animar t√≠tulo de caracter√≠sticas
        inView(
            ".caracteristicas h2",
            ({ target }) => {
                animate(
                    target,
                    { 
                        opacity: [0, 1],
                        y: [30, 0]
                    },
                    { 
                        duration: 0.8,
                        easing: [0.25, 0.1, 0.25, 1] // Easing muy suave
                    }
                );
                
                return () => {};
            },
            { amount: 0.3 }
        );
        
        // Animar items de caracter√≠sticas con stagger suave
        inView(
            ".caracteristica-item",
            ({ target }) => {
                const allItems = document.querySelectorAll('.caracteristica-item');
                
                animate(
                    allItems,
                    { 
                        opacity: [0, 1],
                        y: [50, 0],
                        scale: [0.9, 1]
                    },
                    { 
                        duration: 0.9, // M√°s lento = m√°s suave
                        delay: stagger(0.15), // M√°s delay entre items
                        easing: [0.25, 0.46, 0.45, 0.94] // easeOutQuad suave
                    }
                );
                
                return () => {};
            },
            { amount: 0.2 }
        );
        
        // Hover effects MUY SUAVES para caracter√≠sticas
        const caracteristicaItems = document.querySelectorAll('.caracteristica-item');
        
        caracteristicaItems.forEach(item => {
            const icon = item.querySelector('.caracteristica-icon');
            const title = item.querySelector('h3');
            
            item.addEventListener('mouseenter', function() {
                // Elevaci√≥n suave del card
                animate(
                    this,
                    { 
                        y: -10,
                        scale: 1.03,
                        boxShadow: "0 12px 32px rgba(0, 0, 0, 0.12)"
                    },
                    { 
                        duration: 0.6, // Duraci√≥n m√°s larga
                        easing: [0.34, 1.56, 0.64, 1] // easeOutBack suave
                    }
                );
                
                // Bounce suave en el √≠cono
                if (icon) {
                    animate(
                        icon,
                        { 
                            scale: [1, 1.2, 1.15],
                            rotate: [0, -5, 0]
                        },
                        { 
                            duration: 0.7,
                            easing: [0.68, -0.55, 0.265, 1.55] // easeInOutBack
                        }
                    );
                }
                
                // Color change suave en t√≠tulo
                if (title) {
                    animate(
                        title,
                        { color: "#3A89C9" },
                        { duration: 0.5, easing: "ease-in-out" }
                    );
                }
            });
            
            item.addEventListener('mouseleave', function() {
                // Reset muy suave
                animate(
                    this,
                    { 
                        y: 0,
                        scale: 1,
                        boxShadow: "0 2px 4px rgba(0, 0, 0, 0.1)"
                    },
                    { 
                        duration: 0.6,
                        easing: [0.25, 0.1, 0.25, 1]
                    }
                );
                
                // Reset del √≠cono
                if (icon) {
                    animate(
                        icon,
                        { 
                            scale: 1,
                            rotate: 0
                        },
                        { 
                            duration: 0.6,
                            easing: [0.25, 0.1, 0.25, 1]
                        }
                    );
                }
                
                // Reset del t√≠tulo
                if (title) {
                    animate(
                        title,
                        { color: "#1B325F" },
                        { duration: 0.5, easing: "ease-in-out" }
                    );
                }
            });
        });
        
        // Scroll parallax MUY SUTIL en caracter√≠sticas
        if (window.innerWidth > 768) {
            caracteristicaItems.forEach((item, index) => {
                // Movimiento alternado para crear efecto de profundidad
                const direction = index % 2 === 0 ? 1 : -1;
                
                scroll(
                    animate(
                        item,
                        { 
                            y: [0, direction * 20] // Movimiento muy sutil
                        }
                    ),
                    {
                        target: item,
                        offset: ["start end", "end start"]
                    }
                );
            });
        }
        
        // Animaci√≥n de "float" continua para √≠conos
        const caracteristicaIcons = document.querySelectorAll('.caracteristica-icon');
        
        caracteristicaIcons.forEach((icon, index) => {
            // Delay diferente para cada √≠cono
            setTimeout(() => {
                // Animaci√≥n infinita de flotaci√≥n
                const floatAnimation = () => {
                    animate(
                        icon,
                        { 
                            y: [-3, 3, -3]
                        },
                        { 
                            duration: 3, // 3 segundos por ciclo
                            easing: "ease-in-out",
                            repeat: Infinity
                        }
                    );
                };
                
                // Activar cuando sea visible
                inView(
                    icon,
                    () => {
                        floatAnimation();
                        return () => {}; // No detener la animaci√≥n
                    },
                    { amount: 0.5 }
                );
            }, index * 200); // Delay escalonado
        });
        
        // ========================================
        // CTA SECTION ANIMATION (MUY SUAVE)
        // ========================================
        
        inView(
            ".cta-section",
            ({ target }) => {
                const title = target.querySelector('h2');
                const text = target.querySelector('p');
                const btn = target.querySelector('.btn');
                
                // Animar todo el contenedor con fade suave
                animate(
                    target,
                    { 
                        opacity: [0, 1],
                        scale: [0.95, 1]
                    },
                    { 
                        duration: 1, // Muy lento y suave
                        easing: [0.25, 0.46, 0.45, 0.94]
                    }
                );
                
                // Animar t√≠tulo
                if (title) {
                    animate(
                        title,
                        { 
                            opacity: [0, 1],
                            y: [40, 0]
                        },
                        { 
                            duration: 1,
                            delay: 0.2,
                            easing: [0.34, 1.56, 0.64, 1]
                        }
                    );
                }
                
                // Animar texto
                if (text) {
                    animate(
                        text,
                        { 
                            opacity: [0, 1],
                            y: [40, 0]
                        },
                        { 
                            duration: 1,
                            delay: 0.4,
                            easing: [0.34, 1.56, 0.64, 1]
                        }
                    );
                }
                
                // Animar bot√≥n con bounce suave
                if (btn) {
                    animate(
                        btn,
                        { 
                            opacity: [0, 1],
                            y: [40, 0],
                            scale: [0.8, 1.05, 1]
                        },
                        { 
                            duration: 1.2,
                            delay: 0.6,
                            easing: [0.68, -0.55, 0.265, 1.55]
                        }
                    );
                }
                
                return () => {};
            },
            { amount: 0.3 }
        );
        
        // Hover effect MUY SUAVE para bot√≥n CTA
        const ctaBtn = document.querySelector('.cta-section .btn');
        
        if (ctaBtn) {
            ctaBtn.addEventListener('mouseenter', function() {
                animate(
                    this,
                    { 
                        scale: 1.1,
                        y: -5,
                        boxShadow: "0 16px 40px rgba(0, 0, 0, 0.25)"
                    },
                    { 
                        duration: 0.5,
                        easing: [0.34, 1.56, 0.64, 1] // Bounce suave
                    }
                );
            });
            
            ctaBtn.addEventListener('mouseleave', function() {
                animate(
                    this,
                    { 
                        scale: 1,
                        y: 0,
                        boxShadow: "0 4px 8px rgba(0, 0, 0, 0.15)"
                    },
                    { 
                        duration: 0.5,
                        easing: [0.25, 0.1, 0.25, 1]
                    }
                );
            });
            
            // Efecto de "pulso" sutil continuo
            animate(
                ctaBtn,
                { 
                    scale: [1, 1.02, 1]
                },
                { 
                    duration: 2,
                    easing: "ease-in-out",
                    repeat: Infinity
                }
            );
        }
        
        // ========================================
        // SMOOTH SCROLL PARA ENLACES
        // ========================================
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                if (href !== '#' && href !== '') {
                    e.preventDefault();
                    const target = document.querySelector(href);
                    if (target) {
                        const targetPosition = target.offsetTop - 80; // Offset para navbar
                        
                        animate(
                            window,
                            { scrollTop: targetPosition },
                            { 
                                duration: 1.2, // Scroll muy suave
                                easing: [0.25, 0.46, 0.45, 0.94]
                            }
                        );
                    }
                }
            });
        });
        
    });
</script>
{% endblock %}